{"version":3,"sources":["webpack:///src/components/map.vue","webpack:///./src/components/map.vue?0969","webpack:///./src/components/map.vue"],"names":["map","name","data","value","show","center","lng","lat","position","storeList","infowindows","websock","type","this","$route","query","created","beforeDestroy","intervalId","clearInterval","destroyed","computed","mounted","init","methods","_this","isLoad","setTimeout","res","Object","api_store","countryCode","longitude","latitude","then","result","mapBuild","$store","dispatch","changeSort","val","sortValue","sortVisible","goBack","$router","back","_this2","google","maps","Map","document","getElementById","zoom","mapTypeId","MapTypeId","ROADMAP","contentString","marker","t","forEach","item","i","index","infowindow","InfoWindow","content","format","console","log","Marker","draggable","addListener","open","push","handlerAnotherOne","querySelector","attributes","close","length","handlerGotIt","store","path","invitationCode","registCode","user","storeId","id","setInterval","gotIt","isBind","event","addDomListener","components_map","render","_h","$createElement","_c","_self","staticClass","on","click","_v","staticStyle","height","width","attrs","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/47.01ef1562f71861af52d6.js","sourcesContent":["<template>\n  <div>\n    <section class=\"head\">\n      <div><a @click=\"goBack\" class=\"iconfont back\"> &#xe614; </a></div>\n      <h1>Find Store</h1>\n      <div class=\"chartWrap\"></div>\n    </section>\n    <div id=\"map_canvas\" style=\"height: 100vh; width: 100%\"></div>\n  </div>\n</template>\n\n<script>\nimport { nearbyStore } from \"@/api/store\";\nimport {bindStore} from '@/api/user';\nexport default {\n  name: \"Map\",\n  data() {\n    return {\n      value: \"\",\n      show: false,\n      center: { lng: 120.5, lat: 30.2 },\n      position: {},\n      storeList: [],\n      infowindows:[],\n      websock: null,\n      type:this.$route.query.type||0,\n      map: {}\n    };\n  },\n  created() {},\n  beforeDestroy() {\n    if(this.intervalId){\n      clearInterval(this.intervalId);\n    }\n  },\n  destroyed: function() {},\n  computed: {},\n  mounted() {\n    this.init();\n  },\n  methods: {\n    init() {\n       let isLoad = false;\n      setTimeout(() => {\n        if (isLoad) {\n          return false;\n        }\n        let res = {\n        longitude: 114.406149,\n        latitude: 30.476756\n      };\n        this.center = { lng: res.longitude, lat: res.latitude };\n        nearbyStore({\n          countryCode: \"ES\",\n          longitude: res.longitude,\n          latitude: res.latitude\n        }).then(res => {\n          this.storeList = res.data.result;\n          this.mapBuild();\n        });\n      }, 2000);\n        this.$store.dispatch(\"getUserInfo\").then(res => {\n        isLoad=true;\n        this.center = { lng: res.longitude, lat: res.latitude };\n        nearbyStore({\n          countryCode: \"ES\",\n          longitude: res.longitude,\n          latitude: res.latitude\n        }).then(res => {\n          this.storeList = res.data.result;\n          this.mapBuild();\n        });\n      });\n    },\n    changeSort(val) {\n      this.sortValue = val;\n      this.sortVisible = false;\n    },\n    goBack() {\n      this.$router.back(-1);\n    },\n    //  地图实例\n    mapBuild() {\n      //创建地图实例，zoom是缩放比例\n      this.map = new google.maps.Map(document.getElementById(\"map_canvas\"), {\n        zoom: 12,\n        center: this.center,\n        mapTypeId: google.maps.MapTypeId.ROADMAP\n      });\n\n      let contentString =\n        '<div id=\"content\">' +\n        '<div id=\"siteNotice\">' +\n        \"</div>\" +\n        '<div class=\"storeWrap\">' +\n        '<div class=\"storeNews\">' +\n        '<div class=\"storePhoto\">' +\n        '<img src=\"{img}\">' +\n        \"</div>\" +\n        '<div class=\"right_name\">' +\n        \"<p>{storeName}</p>\" +\n        '<div class=\"address\">' +\n        '<span class=\"iconfont red\"> &#xe601; </span>' +\n        \"<div>{street}</div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        '<div class=\"number\">' +\n        '<div class=\"fansNo\">Fans NO.<font>{fansNum}</font></div>' +\n        '<div class=\"orderNo\">Order NO.<font>{orderNum}</font></div>' +\n        \"</div>\" +\n        '<div class=\"btnWrap\">' +\n        '<div class=\"anotherOne anotherOne_{index}\" data-index=\"{index}\" >Another One</div>' +\n        '<div class=\"gotIt gotIt_{index}\" data-index=\"{index}\" >Got It</div>' +\n        \"</div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        \"</div>\";\n\n      let marker,\n        t = this;\n\n      //这里因为需要很多标记，所以遍历了this.markers（后端给的数据）来循环创建标记\n      this.storeList.forEach((item, i) => {\n        let index = i;\n        item.index = index;\n        let infowindow = new google.maps.InfoWindow({\n          content: contentString.format(item)\n        });\n        console.log(index, item, infowindow.content);\n\n        marker = new google.maps.Marker({\n          position: { lng: item.longitude * 1, lat: item.latitude * 1 },\n          // icon: item.img?item.img:\"../../../static/img/qishou.png\", //标记自定义图标\n          draggable: false, //不可拖动\n          map: this.map //地图实例\n          // labelContent: item.storeName, //label的内容\n          // labelAnchor: new google.maps.Point(22, 0), //label的位置，可以调\n          // labelClass: \"labels\", // the CSS class for the label\n          // labelStyle: { background: \"#fff\", padding: \"5px\" }\n        });\n\n        marker.addListener(\"click\", function() {\n          infowindow.open(this.map, marker);\n        });\n        t.infowindows.push({infowindow,marker});\n      });\n\n      let handlerAnotherOne=()=>{\n         let el = document.querySelector(\".anotherOne\");\n         let index=el.attributes['data-index'].value*1;\n         t.infowindows[index].infowindow.close(); //this.map,t.infowindows[index].marker\n         if(t.infowindows.length>1){\n           t.infowindows[index==t.infowindows.length-1?0:index+1].infowindow.open(t.map, t.infowindows[index==t.infowindows.length-1?0:index+1].marker);\n         }\n\n      };\n      let handlerGotIt=()=>{\n         let el = document.querySelector(\".gotIt\");\n        let index=el.attributes['data-index'].value*1;\n        let store=t.storeList[index];\n        if(t.type==0){\n            t.$router.push({path:'login',query:{invitationCode:store.registCode}});\n        }else if(t.type==1){\n            t.$router.push({path:'fillInvitation',query:{invitationCode:store.registCode}});\n        }else{\n           bindStore({\n            storeId:store.id\n        }).then(res=>{\n          t.$router.push({path:'/',query:{}});\n        });\n        }\n      }\n\n      let a = () => {\n        if (!document.querySelector(\".gotIt\")) {\n          return false;\n        }\n        if (document.querySelector(\".gotIt\")) {\n          let gotIt = document.querySelector(\".gotIt\");\n          if (gotIt.isBind) {\n            return false;\n          }\n          google.maps.event.addDomListener(gotIt, \"click\", handlerGotIt);\n\n          google.maps.event.addDomListener(\n            document.querySelector(\".anotherOne\"),\n            \"click\",\n            handlerAnotherOne\n          );\n          gotIt.isBind = true;\n        }\n      };\n\n      this.intervalId=setInterval(a,100);\n      \n    }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n#map_canvas /deep/ .storeWrap {\n  width: 273px;\n  height: 177px;\n  .storeNews {\n    width: 100%;\n    display: -webkit-box;\n    padding-top: 20px;\n    .storePhoto {\n      width: 57px;\n      height: 57px;\n      border-radius: 50%;\n      overflow: hidden;\n      border: none;\n      margin-right: 18px;\n      img {\n        width: 100%;\n        height: 100%;\n      }\n    }\n    .right_name {\n      width: 198px;\n      padding-top: 10px;\n      p {\n        font-size: 14px;\n        color: #333333;\n        padding-bottom: 8px;\n      }\n      .address {\n        display: -webkit-box;\n        div {\n          font-size: 13px;\n          color: #999999;\n          width: 180px;\n          word-wrap: break-word;\n          word-break: break-all;\n          overflow: hidden;\n          padding-left: 5px;\n        }\n      }\n    }\n  }\n  .number {\n    width: 100%;\n    display: -webkit-box;\n    padding-top: 10px;\n    div {\n      height: 20px;\n      width: 50%;\n      text-align: center;\n      line-height: 20px;\n    }\n    .fansNo {\n      color: #666666;\n      font-size: 11px;\n      border-right: 1px solid #999999;\n      font {\n        color: #111111;\n        font-size: 13px;\n      }\n    }\n    .orderNo {\n      color: #666666;\n      font-size: 11px;\n      font {\n        color: #111111;\n        font-size: 13px;\n      }\n    }\n  }\n  .btnWrap {\n    height: 32px;\n    margin-top: 15px;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    .anotherOne {\n      border: 1px solid #e33946;\n      font-size: 15px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      width: 100px;\n      margin: 0 15px;\n      color: #e33946;\n    }\n    .gotIt {\n      border: 1px solid #e33946;\n      height: 100%;\n      width: 100px;\n      background: #e33946;\n      font-size: 15px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      width: 100px;\n      margin: 0 15px;\n      color: #ffffff;\n    }\n  }\n}\n#map_canvas /deep/ .gm-style .gm-style-iw-c {\n  max-width: 303px !important;\n}\n#map_canvas /deep/ .gm-style .gm-style-iw-d {\n  max-width: 303px !important;\n}\n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/map.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('section',{staticClass:\"head\"},[_c('div',[_c('a',{staticClass:\"iconfont back\",on:{\"click\":_vm.goBack}},[_vm._v(\"  \")])]),_vm._v(\" \"),_c('h1',[_vm._v(\"Find Store\")]),_vm._v(\" \"),_c('div',{staticClass:\"chartWrap\"})]),_vm._v(\" \"),_c('div',{staticStyle:{\"height\":\"100vh\",\"width\":\"100%\"},attrs:{\"id\":\"map_canvas\"}})])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler?{\"id\":\"data-v-4f63194c\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.3@vue-loader/lib/selector.js?type=template&index=0!./src/components/map.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4f63194c\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=styles&index=0!./map.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./map.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./map.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4f63194c\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=template&index=0!./map.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-4f63194c\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/map.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}