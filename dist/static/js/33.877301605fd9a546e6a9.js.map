{"version":3,"sources":["webpack:///src/components/map.vue","webpack:///./src/components/map.vue?6591","webpack:///./src/components/map.vue"],"names":["map","name","data","value","show","center","lng","lat","position","storeList","infowindows","websock","type","this","$route","query","tel","param","nickname","sex","email","registerPwd","created","beforeDestroy","intervalId","clearInterval","destroyed","computed","mounted","init","methods","_this","isLoad","setTimeout","res","Object","api_store","countryCode","longitude","latitude","then","result","mapBuild","$store","dispatch","changeSort","val","sortValue","sortVisible","goBack","$router","back","_this2","google","maps","Map","document","getElementById","zoom","mapTypeId","MapTypeId","ROADMAP","contentString","marker","t","forEach","item","i","index","infowindow","InfoWindow","content","format","console","log","Marker","draggable","addListener","open","push","handlerAnotherOne","querySelector","attributes","close","length","handlerGotIt","store","queryParam","invitationCode","registCode","path","stringify_default","go","user","storeId","id","setInterval","gotIt","isBind","event","addDomListener","components_map","render","_h","$createElement","_c","_self","staticClass","on","click","_v","staticStyle","height","width","attrs","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/33.877301605fd9a546e6a9.js","sourcesContent":["<template>\n  <div>\n    <section class=\"head\">\n      <div><a @click=\"goBack\" class=\"iconfont back\"> &#xe614; </a></div>\n      <h1>Find Store</h1>\n      <div class=\"chartWrap\"></div>\n    </section>\n    <div id=\"map_canvas\" style=\"height: 100vh; width: 100%\"></div>\n  </div>\n</template>\n\n<script>\nimport { nearbyStore } from \"@/api/store\";\nimport {bindStore} from '@/api/user';\nexport default {\n  name: \"Map\",\n  data() {\n    return {\n      value: \"\",\n      show: false,\n      center: { lng: 120.5, lat: 30.2 },\n      position: {},\n      storeList: [],\n      infowindows:[],\n      websock: null,\n      type:this.$route.query.type||0,\n      map: {},\n      tel: this.$route.query.param ? this.$route.query.param.tel : \"\",\n      nickname: this.$route.query.param ? this.$route.query.param.nickname : \"\",\n      sex: this.$route.query.param ? (this.$route.query.param.sex ? this.$route.query.param.sex : \"Man\") : \"Man\",\n      email: this.$route.query.param ? this.$route.query.param.email : \"\",\n      registerPwd: this.$route.query.param ? this.$route.query.param.registerPwd : \"\",\n    };\n  },\n  created() {},\n  beforeDestroy() {\n    if(this.intervalId){\n      clearInterval(this.intervalId);\n    }\n  },\n  destroyed: function() {},\n  computed: {},\n  mounted() {\n    this.init();\n  },\n  methods: {\n    init() {\n       let isLoad = false;\n      setTimeout(() => {\n        if (isLoad) {\n          return false;\n        }\n        let res = {\n        longitude: 114.406149,\n        latitude: 30.476756\n      };\n        this.center = { lng: res.longitude, lat: res.latitude };\n        nearbyStore({\n          countryCode: \"ES\",\n          longitude: res.longitude,\n          latitude: res.latitude\n        }).then(res => {\n          this.storeList = res.data.result;\n          this.mapBuild();\n        });\n      }, 2000);\n        this.$store.dispatch(\"getUserInfo\").then(res => {\n        isLoad=true;\n        this.center = { lng: res.longitude, lat: res.latitude };\n        nearbyStore({\n          countryCode: \"ES\",\n          longitude: res.longitude,\n          latitude: res.latitude\n        }).then(res => {\n          this.storeList = res.data.result;\n          this.mapBuild();\n        });\n      });\n    },\n    changeSort(val) {\n      this.sortValue = val;\n      this.sortVisible = false;\n    },\n    goBack() {\n      this.$router.back(-1);\n    },\n    //  地图实例\n    mapBuild() {\n      //创建地图实例，zoom是缩放比例\n      this.map = new google.maps.Map(document.getElementById(\"map_canvas\"), {\n        zoom: 12,\n        center: this.center,\n        mapTypeId: google.maps.MapTypeId.ROADMAP\n      });\n\n      let contentString =\n        '<div id=\"content\">' +\n        '<div id=\"siteNotice\">' +\n        \"</div>\" +\n        '<div class=\"storeWrap\">' +\n        '<div class=\"storeNews\">' +\n        '<div class=\"storePhoto\">' +\n        '<img src=\"{img}\">' +\n        \"</div>\" +\n        '<div class=\"right_name\">' +\n        \"<p>{storeName}</p>\" +\n        '<div class=\"address\">' +\n        '<span class=\"iconfont red\"> &#xe601; </span>' +\n        \"<div>{street}</div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        '<div class=\"number\">' +\n        '<div class=\"fansNo\">Fans NO.<font>{fansNum}</font></div>' +\n        '<div class=\"orderNo\">Order NO.<font>{orderNum}</font></div>' +\n        \"</div>\" +\n        '<div class=\"btnWrap\">' +\n        '<div class=\"anotherOne anotherOne_{index}\" data-index=\"{index}\" >Another One</div>' +\n        '<div class=\"gotIt gotIt_{index}\" data-index=\"{index}\" >Got It</div>' +\n        \"</div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        \"</div>\";\n\n      let marker,\n        t = this;\n\n      //这里因为需要很多标记，所以遍历了this.markers（后端给的数据）来循环创建标记\n      this.storeList.forEach((item, i) => {\n        let index = i;\n        item.index = index;\n        let infowindow = new google.maps.InfoWindow({\n          content: contentString.format(item)\n        });\n        console.log(index, item, infowindow.content);\n\n        marker = new google.maps.Marker({\n          position: { lng: item.longitude * 1, lat: item.latitude * 1 },\n          // icon: item.img?item.img:\"../../../static/img/qishou.png\", //标记自定义图标\n          draggable: false, //不可拖动\n          map: this.map //地图实例\n          // labelContent: item.storeName, //label的内容\n          // labelAnchor: new google.maps.Point(22, 0), //label的位置，可以调\n          // labelClass: \"labels\", // the CSS class for the label\n          // labelStyle: { background: \"#fff\", padding: \"5px\" }\n        });\n\n        marker.addListener(\"click\", function() {\n          infowindow.open(this.map, marker);\n        });\n        t.infowindows.push({infowindow,marker});\n      });\n\n      let handlerAnotherOne=()=>{\n         let el = document.querySelector(\".anotherOne\");\n         let index=el.attributes['data-index'].value*1;\n         t.infowindows[index].infowindow.close(); //this.map,t.infowindows[index].marker\n         if(t.infowindows.length>1){\n           t.infowindows[index==t.infowindows.length-1?0:index+1].infowindow.open(t.map, t.infowindows[index==t.infowindows.length-1?0:index+1].marker);\n         }\n\n      };\n      let handlerGotIt=()=>{\n         let el = document.querySelector(\".gotIt\");\n        let index=el.attributes['data-index'].value*1;\n        let store=t.storeList[index];\n        if(t.type==0){\n            let queryParam = {\n                invitationCode:store.registCode,\n                registerPwd: this.registerPwd,\n                tel: this.tel,\n                nickname: this.nickname,\n                sex: this.sex,\n                email: this.email,\n            }\n            t.$router.push({path:'login',query:{param:queryParam}\n                \n            });\n        }else if(t.type==1){\n            t.$router.push({path:'fillInvitation',query:{invitationCode:store.registCode}});\n        }else if(t.type==2){\n            t.$store.dispatch('changeLocation',JSON.stringify(store));\n            t.$router.go(-1);\n        }else{\n           bindStore({\n            storeId:store.id\n        }).then(res=>{\n          t.$router.push({path:'/',query:{}});\n        });\n        }\n      }\n\n      let a = () => {\n        if (!document.querySelector(\".gotIt\")) {\n          return false;\n        }\n        if (document.querySelector(\".gotIt\")) {\n          let gotIt = document.querySelector(\".gotIt\");\n          if (gotIt.isBind) {\n            return false;\n          }\n          google.maps.event.addDomListener(gotIt, \"click\", handlerGotIt);\n\n          google.maps.event.addDomListener(\n            document.querySelector(\".anotherOne\"),\n            \"click\",\n            handlerAnotherOne\n          );\n          gotIt.isBind = true;\n        }\n      };\n\n      this.intervalId=setInterval(a,100);\n      \n    }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n#map_canvas /deep/ .storeWrap {\n  width: 273px;\n  height: 177px;\n  .storeNews {\n    width: 100%;\n    display: -webkit-box;\n    padding-top: 20px;\n    .storePhoto {\n      width: 57px;\n      height: 57px;\n      border-radius: 50%;\n      overflow: hidden;\n      border: none;\n      margin-right: 18px;\n      img {\n        width: 100%;\n        height: 100%;\n      }\n    }\n    .right_name {\n      width: 198px;\n      padding-top: 10px;\n      p {\n        font-size: 14px;\n        color: #333333;\n        padding-bottom: 8px;\n      }\n      .address {\n        display: -webkit-box;\n        div {\n          font-size: 13px;\n          color: #999999;\n          width: 180px;\n          word-wrap: break-word;\n          word-break: break-all;\n          overflow: hidden;\n          padding-left: 5px;\n        }\n      }\n    }\n  }\n  .number {\n    width: 100%;\n    display: -webkit-box;\n    padding-top: 10px;\n    div {\n      height: 20px;\n      width: 50%;\n      text-align: center;\n      line-height: 20px;\n    }\n    .fansNo {\n      color: #666666;\n      font-size: 11px;\n      border-right: 1px solid #999999;\n      font {\n        color: #111111;\n        font-size: 13px;\n      }\n    }\n    .orderNo {\n      color: #666666;\n      font-size: 11px;\n      font {\n        color: #111111;\n        font-size: 13px;\n      }\n    }\n  }\n  .btnWrap {\n    height: 32px;\n    margin-top: 15px;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    .anotherOne {\n      border: 1px solid #e33946;\n      font-size: 15px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      width: 100px;\n      margin: 0 15px;\n      color: #e33946;\n    }\n    .gotIt {\n      border: 1px solid #e33946;\n      height: 100%;\n      width: 100px;\n      background: #e33946;\n      font-size: 15px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      width: 100px;\n      margin: 0 15px;\n      color: #ffffff;\n    }\n  }\n}\n#map_canvas /deep/ .gm-style .gm-style-iw-c {\n  max-width: 303px !important;\n}\n#map_canvas /deep/ .gm-style .gm-style-iw-d {\n  max-width: 303px !important;\n}\n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/map.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('section',{staticClass:\"head\"},[_c('div',[_c('a',{staticClass:\"iconfont back\",on:{\"click\":_vm.goBack}},[_vm._v(\"  \")])]),_vm._v(\" \"),_c('h1',[_vm._v(\"Find Store\")]),_vm._v(\" \"),_c('div',{staticClass:\"chartWrap\"})]),_vm._v(\" \"),_c('div',{staticStyle:{\"height\":\"100vh\",\"width\":\"100%\"},attrs:{\"id\":\"map_canvas\"}})])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler?{\"id\":\"data-v-d43581a2\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.3@vue-loader/lib/selector.js?type=template&index=0!./src/components/map.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-d43581a2\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=styles&index=0!./map.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./map.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./map.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-d43581a2\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=template&index=0!./map.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-d43581a2\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/map.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}